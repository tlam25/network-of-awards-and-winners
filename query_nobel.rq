# All Nobel-related prizes (Physics, Chemistry, Medicine, Literature, Peace, Economic Sciences)
# All years (no date filter)
# Shows: countries, occupations, fieldsOfWork, educatedAt, employers, memberOf, motivationEn
SELECT ?laureate ?laureateLabel ?award ?awardLabel ?year
       (GROUP_CONCAT(DISTINCT ?countryLabel;    separator=", ") AS ?countries)
       (GROUP_CONCAT(DISTINCT ?occupationLabel; separator=", ") AS ?occupations)
       (GROUP_CONCAT(DISTINCT ?fieldLabel;      separator=", ") AS ?fieldsOfWork)
       (GROUP_CONCAT(DISTINCT ?eduLabel;        separator=", ") AS ?educatedAt)
       (GROUP_CONCAT(DISTINCT ?empLabel;        separator=", ") AS ?employers)
       (GROUP_CONCAT(DISTINCT ?memberLabel;     separator=", ") AS ?memberOf)
       (GROUP_CONCAT(DISTINCT ?motTxt;          separator=" | ") AS ?motivationEn)
WHERE {
  # 6 hạng mục Nobel chính
  VALUES ?award {
    wd:Q38104  # Physics
    wd:Q44585  # Chemistry
    wd:Q80061  # Physiology or Medicine
    wd:Q37922  # Literature
    wd:Q35637  # Peace
    wd:Q60110  # Economic Sciences
  }

  # Core: đúng statement trao giải (p:P166)
  ?laureate p:P166 ?st .
  ?st ps:P166 ?award .

  # Năm (nếu có trên qualifier P585)
  OPTIONAL { ?st pq:P585 ?date . }
  BIND(IF(BOUND(?date), YEAR(?date), xsd:integer(0)) AS ?year)

  # Motivation (tiếng Anh) ngay trên statement ?st
  OPTIONAL {
    { ?st pq:P6208 ?motTxt . FILTER(LANG(?motTxt)="en") }
    UNION
    { ?st pq:P1686 ?motTxt . FILTER(LANG(?motTxt)="en") }
    UNION
    { ?st pq:P1478 ?motTxt . FILTER(LANG(?motTxt)="en") }
  }

  # Countries
  OPTIONAL {
    ?laureate wdt:P27 ?country .
    ?country rdfs:label ?countryLabel FILTER(LANG(?countryLabel)="en")
  }

  # Occupations
  OPTIONAL {
    ?laureate wdt:P106 ?occupation .
    ?occupation rdfs:label ?occupationLabel FILTER(LANG(?occupationLabel)="en")
  }

  # Field of work
  OPTIONAL {
    ?laureate wdt:P101 ?field .
    ?field rdfs:label ?fieldLabel FILTER(LANG(?fieldLabel)="en")
  }

  # Educated at
  OPTIONAL {
    ?laureate wdt:P69 ?edu .
    ?edu rdfs:label ?eduLabel FILTER(LANG(?eduLabel)="en")
  }

  # Employer
  OPTIONAL {
    ?laureate wdt:P108 ?emp .
    ?emp rdfs:label ?empLabel FILTER(LANG(?empLabel)="en")
  }

  # Member of
  OPTIONAL {
    ?laureate wdt:P463 ?member .
    ?member rdfs:label ?memberLabel FILTER(LANG(?memberLabel)="en")
  }

  # Labels chính
  OPTIONAL { ?laureate rdfs:label ?laureateLabel FILTER(LANG(?laureateLabel)="en") }
  OPTIONAL { ?award    rdfs:label ?awardLabel    FILTER(LANG(?awardLabel)="en") }
}
GROUP BY ?laureate ?laureateLabel ?award ?awardLabel ?year
# ORDER BY ?year ?awardLabel   # nếu cần, bật sau (có thể làm chậm)
# LIMIT 5000 OFFSET 0          # gợi ý phân trang để tránh timeout